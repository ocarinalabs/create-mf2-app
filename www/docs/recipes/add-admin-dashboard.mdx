---
title: "Add Admin Dashboard"
description: "Build a powerful admin panel in 15 minutes"
icon: "gauge-max"
---

# Admin Dashboard

Every SaaS needs an admin dashboard. Here's how to build one that lets you manage users, view metrics, and handle support tickets without leaving your app.

<Note>
  **Time estimate**: 15 minutes to functional dashboard, 30 minutes to production-ready.
</Note>

## What you'll build

- üîí Protected admin routes
- üìà Real-time metrics dashboard
- üë• User management interface
- üìß Support ticket system
- üí≥ Payment/subscription overview
- üîç Searchable activity logs

## Step 1: Protect admin routes (2 min)

Create the admin layout with protection:

```tsx src/app/(admin)/layout.tsx
import { auth } from "@clerk/nextjs/server";
import { redirect } from "next/navigation";

export default async function AdminLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  const { userId } = await auth();
  
  if (!userId) {
    redirect("/sign-in");
  }
  
  // Check if user is admin
  const user = await getUserById(userId);
  if (!user?.isAdmin) {
    redirect("/dashboard");
  }
  
  return (
    <div className="min-h-screen bg-background">
      <AdminSidebar />
      <main className="lg:pl-64">
        <div className="p-8">{children}</div>
      </main>
    </div>
  );
}
```

## Step 2: Add admin flag to users (3 min)

Update your schema:

```typescript convex/schema.ts
import { defineSchema, defineTable } from "convex/server";
import { v } from "convex/values";

export default defineSchema({
  users: defineTable({
    // ... existing fields
    isAdmin: v.boolean(),
    adminSince: v.optional(v.number()),
  }).index("by_clerk_id", ["clerkId"]),
  
  // Add audit logs
  adminLogs: defineTable({
    adminId: v.id("users"),
    action: v.string(),
    targetType: v.string(),
    targetId: v.string(),
    metadata: v.optional(v.any()),
    timestamp: v.number(),
  })
    .index("by_admin", ["adminId"])
    .index("by_timestamp", ["timestamp"]),
});
```

Create admin check function:

```typescript convex/admin.ts
import { query } from "./_generated/server";

export const isAdmin = query({
  handler: async (ctx) => {
    const identity = await ctx.auth.getUserIdentity();
    if (!identity) return false;
    
    const user = await ctx.db
      .query("users")
      .withIndex("by_clerk_id", q => 
        q.eq("clerkId", identity.subject)
      )
      .unique();
    
    return user?.isAdmin || false;
  },
});

// Helper to log admin actions
export const logAdminAction = async (
  ctx: any,
  action: string,
  targetType: string,
  targetId: string,
  metadata?: any
) => {
  const identity = await ctx.auth.getUserIdentity();
  if (!identity) return;
  
  const admin = await ctx.db
    .query("users")
    .withIndex("by_clerk_id", q => 
      q.eq("clerkId", identity.subject)
    )
    .unique();
  
  if (admin?.isAdmin) {
    await ctx.db.insert("adminLogs", {
      adminId: admin._id,
      action,
      targetType,
      targetId,
      metadata,
      timestamp: Date.now(),
    });
  }
};
```

## Step 3: Build the metrics dashboard (5 min)

```tsx src/app/(admin)/admin/page.tsx
"use client";

import { useQuery } from "convex/react";
import { api } from "@/convex/_generated/api";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Users, DollarSign, Activity, TrendingUp } from "lucide-react";

export default function AdminDashboard() {
  const stats = useQuery(api.admin.getDashboardStats);
  const recentActivity = useQuery(api.admin.getRecentActivity);
  
  if (!stats) return <DashboardSkeleton />;
  
  return (
    <div className="space-y-8">
      <h1 className="text-3xl font-bold">Admin Dashboard</h1>
      
      {/* Metrics Cards */}
      <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
        <MetricCard
          title="Total Users"
          value={stats.totalUsers}
          change={stats.userGrowth}
          icon={Users}
        />
        <MetricCard
          title="Monthly Revenue"
          value={`$${stats.monthlyRevenue}`}
          change={stats.revenueGrowth}
          icon={DollarSign}
        />
        <MetricCard
          title="Active Users"
          value={stats.activeUsers}
          change={stats.activeUserGrowth}
          icon={Activity}
        />
        <MetricCard
          title="Conversion Rate"
          value={`${stats.conversionRate}%`}
          change={stats.conversionGrowth}
          icon={TrendingUp}
        />
      </div>
      
      {/* Recent Activity */}
      <Card>
        <CardHeader>
          <CardTitle>Recent Activity</CardTitle>
        </CardHeader>
        <CardContent>
          <ActivityFeed activities={recentActivity} />
        </CardContent>
      </Card>
      
      {/* Charts */}
      <div className="grid gap-4 md:grid-cols-2">
        <RevenueChart data={stats.revenueHistory} />
        <UserGrowthChart data={stats.userGrowthHistory} />
      </div>
    </div>
  );
}
```

Add the stats query:

```typescript convex/admin.ts
export const getDashboardStats = query({
  handler: async (ctx) => {
    // Check admin status
    const isUserAdmin = await isAdmin(ctx);
    if (!isUserAdmin) throw new Error("Unauthorized");
    
    // Get all users
    const users = await ctx.db.query("users").collect();
    const totalUsers = users.length;
    
    // Get active users (logged in last 30 days)
    const thirtyDaysAgo = Date.now() - (30 * 24 * 60 * 60 * 1000);
    const activeUsers = users.filter(u => 
      u.lastActive && u.lastActive > thirtyDaysAgo
    ).length;
    
    // Calculate growth
    const lastMonthUsers = users.filter(u => 
      u.createdAt > Date.now() - (60 * 24 * 60 * 60 * 1000)
    ).length;
    const userGrowth = ((lastMonthUsers / totalUsers) * 100).toFixed(1);
    
    // Get revenue data (from your payments)
    const subscriptions = await ctx.db
      .query("subscriptions")
      .filter(q => q.eq(q.field("status"), "active"))
      .collect();
    
    const monthlyRevenue = subscriptions.reduce((sum, sub) => 
      sum + (sub.amount || 0), 0
    );
    
    return {
      totalUsers,
      activeUsers,
      monthlyRevenue,
      conversionRate: ((subscriptions.length / totalUsers) * 100).toFixed(1),
      userGrowth,
      activeUserGrowth: "12.5", // Calculate based on your data
      revenueGrowth: "23.1",
      conversionGrowth: "3.2",
      revenueHistory: [], // Add historical data
      userGrowthHistory: [], // Add historical data
    };
  },
});
```

## Step 4: User management interface (5 min)

```tsx src/app/(admin)/admin/users/page.tsx
"use client";

import { useState } from "react";
import { useQuery, useMutation } from "convex/react";
import { api } from "@/convex/_generated/api";
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from "@/components/ui/table";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Badge } from "@/components/ui/badge";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";
import { MoreHorizontal, Search } from "lucide-react";

export default function UsersPage() {
  const [search, setSearch] = useState("");
  const users = useQuery(api.admin.getUsers, { search });
  const updateUser = useMutation(api.admin.updateUser);
  const deleteUser = useMutation(api.admin.deleteUser);
  
  return (
    <div className="space-y-6">
      <div className="flex justify-between items-center">
        <h1 className="text-3xl font-bold">Users</h1>
        <div className="flex gap-4">
          <div className="relative">
            <Search className="absolute left-3 top-3 h-4 w-4 text-muted-foreground" />
            <Input
              placeholder="Search users..."
              value={search}
              onChange={(e) => setSearch(e.target.value)}
              className="pl-9 w-[300px]"
            />
          </div>
          <Button>Export CSV</Button>
        </div>
      </div>
      
      <Card>
        <Table>
          <TableHeader>
            <TableRow>
              <TableHead>User</TableHead>
              <TableHead>Status</TableHead>
              <TableHead>Subscription</TableHead>
              <TableHead>Joined</TableHead>
              <TableHead>Last Active</TableHead>
              <TableHead className="text-right">Actions</TableHead>
            </TableRow>
          </TableHeader>
          <TableBody>
            {users?.map((user) => (
              <TableRow key={user._id}>
                <TableCell>
                  <div>
                    <div className="font-medium">{user.name}</div>
                    <div className="text-sm text-muted-foreground">
                      {user.email}
                    </div>
                  </div>
                </TableCell>
                <TableCell>
                  <Badge variant={user.isActive ? "default" : "secondary"}>
                    {user.isActive ? "Active" : "Inactive"}
                  </Badge>
                </TableCell>
                <TableCell>
                  <Badge variant={user.subscription ? "default" : "outline"}>
                    {user.subscription || "Free"}
                  </Badge>
                </TableCell>
                <TableCell>{formatDate(user.createdAt)}</TableCell>
                <TableCell>{formatDate(user.lastActive)}</TableCell>
                <TableCell className="text-right">
                  <UserActions 
                    user={user}
                    onUpdate={updateUser}
                    onDelete={deleteUser}
                  />
                </TableCell>
              </TableRow>
            ))}
          </TableBody>
        </Table>
      </Card>
    </div>
  );
}
```

## Step 5: Quick actions & tools (5 min)

Add admin mutations:

```typescript convex/admin.ts
import { mutation } from "./_generated/server";
import { v } from "convex/values";

// Toggle user's admin status
export const toggleAdmin = mutation({
  args: { userId: v.id("users") },
  handler: async (ctx, args) => {
    // Verify caller is admin
    const isUserAdmin = await isAdmin(ctx);
    if (!isUserAdmin) throw new Error("Unauthorized");
    
    const user = await ctx.db.get(args.userId);
    if (!user) throw new Error("User not found");
    
    await ctx.db.patch(args.userId, {
      isAdmin: !user.isAdmin,
      adminSince: !user.isAdmin ? Date.now() : undefined,
    });
    
    await logAdminAction(
      ctx,
      user.isAdmin ? "REVOKE_ADMIN" : "GRANT_ADMIN",
      "user",
      args.userId
    );
  },
});

// Suspend/unsuspend user
export const toggleUserStatus = mutation({
  args: { userId: v.id("users") },
  handler: async (ctx, args) => {
    const isUserAdmin = await isAdmin(ctx);
    if (!isUserAdmin) throw new Error("Unauthorized");
    
    const user = await ctx.db.get(args.userId);
    if (!user) throw new Error("User not found");
    
    await ctx.db.patch(args.userId, {
      isSuspended: !user.isSuspended,
      suspendedAt: !user.isSuspended ? Date.now() : undefined,
    });
    
    await logAdminAction(
      ctx,
      user.isSuspended ? "UNSUSPEND_USER" : "SUSPEND_USER",
      "user",
      args.userId,
      { reason: "Admin action" }
    );
  },
});

// Send announcement to all users
export const sendAnnouncement = mutation({
  args: {
    title: v.string(),
    message: v.string(),
    type: v.union(v.literal("info"), v.literal("warning")),
  },
  handler: async (ctx, args) => {
    const isUserAdmin = await isAdmin(ctx);
    if (!isUserAdmin) throw new Error("Unauthorized");
    
    // Create announcement
    const announcementId = await ctx.db.insert("announcements", {
      ...args,
      createdAt: Date.now(),
      createdBy: (await ctx.auth.getUserIdentity())!.subject,
    });
    
    // Could trigger email notifications here
    
    await logAdminAction(
      ctx,
      "CREATE_ANNOUNCEMENT",
      "announcement",
      announcementId
    );
  },
});
```

## Advanced features

### Add impersonation

```typescript
// convex/admin.ts
export const impersonateUser = mutation({
  args: { userId: v.id("users") },
  handler: async (ctx, args) => {
    const isUserAdmin = await isAdmin(ctx);
    if (!isUserAdmin) throw new Error("Unauthorized");
    
    // Create impersonation token
    const token = await ctx.db.insert("impersonationTokens", {
      adminId: (await ctx.auth.getUserIdentity())!.subject,
      userId: args.userId,
      createdAt: Date.now(),
      expiresAt: Date.now() + (60 * 60 * 1000), // 1 hour
    });
    
    await logAdminAction(
      ctx,
      "IMPERSONATE_USER",
      "user",
      args.userId
    );
    
    return token;
  },
});
```

### Add support ticket system

```tsx src/app/(admin)/admin/support/page.tsx
const SupportDashboard = () => {
  const tickets = useQuery(api.support.getTickets, { 
    status: "open" 
  });
  
  return (
    <div className="space-y-6">
      <TicketFilters />
      <TicketList tickets={tickets} />
      <TicketStats />
    </div>
  );
};
```

### Add system health monitoring

```tsx
const SystemHealth = () => {
  const health = useQuery(api.admin.getSystemHealth);
  
  return (
    <div className="grid gap-4 md:grid-cols-3">
      <HealthMetric
        name="API Response Time"
        value={health.apiResponseTime}
        status={health.apiStatus}
      />
      <HealthMetric
        name="Database Queries"
        value={health.dbQueryTime}
        status={health.dbStatus}
      />
      <HealthMetric
        name="Error Rate"
        value={health.errorRate}
        status={health.errorStatus}
      />
    </div>
  );
};
```

## Security best practices

<Warning>
  **Always double-check admin permissions** in every mutation and query. One mistake = bad day.
</Warning>

1. **Separate admin API**
   ```typescript
   // convex/admin.ts - Admin only functions
   // convex/public.ts - Public functions
   ```

2. **Log everything**
   ```typescript
   await logAdminAction(ctx, "DELETE_USER", "user", userId);
   ```

3. **Rate limit admin actions**
   ```typescript
   const recentActions = await ctx.db
     .query("adminLogs")
     .withIndex("by_admin", q => q.eq("adminId", adminId))
     .filter(q => q.gt(q.field("timestamp"), Date.now() - 60000))
     .collect();
   
   if (recentActions.length > 10) {
     throw new Error("Rate limit exceeded");
   }
   ```

## Deploy checklist

- [ ] Set first admin manually in database
- [ ] Test all admin permissions
- [ ] Add IP allowlist for admin routes
- [ ] Enable 2FA for admin accounts
- [ ] Set up alerts for admin actions
- [ ] Create admin onboarding docs

## Next steps

<CardGroup cols={2}>
  <Card title="Add analytics" icon="chart-line" href="/recipes/integrate-analytics">
    Deep dive into user behavior
  </Card>
  <Card title="Email reports" icon="envelope" href="/recipes/automated-reports">
    Weekly admin summaries
  </Card>
</CardGroup>

You now have a production-ready admin dashboard. Your support team will thank you, and you'll actually know what's happening in your app.

Remember: With great power comes great responsibility. Don't accidentally delete all your users. We've all been there.